<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake â€“ ë‹¨ì¼ HTML</title>
<style>
  :root {
    --bg: #0e101a;
    --panel: #171a2b;
    --text: #e8ebf2;
    --grid: #222644;
    --head: #41d1ff;
    --body: #59f28a;
    --food: #ff6b6b;
    --accent: #7aa2ff;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; min-height: 100svh; display: grid; place-items: center;
    background: radial-gradient(1200px 700px at 15% 20%, #12152a, var(--bg));
    color: var(--text); font: 15px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    padding: 16px;
  }
  .wrap { width: min(92vw, 720px); }
  header {
    display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;
    margin-bottom: 12px;
  }
  .hud {
    display: inline-flex; gap: 10px; flex-wrap: wrap; align-items: center;
    border: 1px solid #2c2f52; background: color-mix(in oklab, var(--panel), black 10%);
    padding: 8px 12px; border-radius: 10px;
  }
  .pill { background: #1b1f3a; padding: 6px 10px; border-radius: 999px; }
  .pill strong { color: var(--accent); }
  .buttons { display: inline-flex; gap: 8px; }
  button {
    background: #1b1f3a; color: var(--text); border: 1px solid #2c2f52;
    padding: 8px 12px; border-radius: 8px; cursor: pointer;
  }
  button:disabled { opacity: .6; cursor: not-allowed; }
  button:hover { filter: brightness(1.1); }

  #board {
    width: 100%; aspect-ratio: 1 / 1;
    image-rendering: pixelated;
    display: block; border: 1px solid #2c2f52; border-radius: 12px;
    background: #0a0c18;
  }

  footer { text-align: center; opacity: .75; margin-top: 10px; font-size: 13px; }
  .sr-only { position: absolute; width: 1px; height: 1px; overflow: hidden; left: -9999px; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="hud" role="group" aria-label="ê²Œì„ ìƒíƒœ">
        <span class="pill">ì ìˆ˜: <strong id="score">0</strong></span>
        <span class="pill">ìµœê³ : <strong id="high">0</strong></span>
        <span class="pill">ì†ë„: <strong id="speedLabel">ë³´í†µ</strong></span>
        <span id="live" class="sr-only" aria-live="polite"></span>
      </div>
      <div class="buttons">
        <button id="startBtn">â–¶ï¸ ì‹œì‘</button>
        <button id="pauseBtn" disabled>â¸ï¸ ì¼ì‹œì •ì§€</button>
        <button id="resetBtn">ğŸ” ë¦¬ì…‹</button>
      </div>
    </header>

    <!-- ë‚´ë¶€ í•´ìƒë„(ê²©ì Ã— ì…€í¬ê¸°)ëŠ” JSì—ì„œ ì„¤ì • -->
    <canvas id="board" width="480" height="480" aria-label="ìŠ¤ë„¤ì´í¬ ê²Œì„ ë³´ë“œ" role="img"></canvas>

    <footer>ì¡°ì‘: í‚¤ë³´ë“œ <b>â† â†‘ â†’ â†“</b> í™”ì‚´í‘œ í‚¤. ë¨¹ì´ë¥¼ ë¨¹ì–´ ì ìˆ˜ë¥¼ ì˜¬ë¦¬ì„¸ìš”!</footer>
  </div>

<script>
/* =========================================================
   Snake â€“ ë‹¨ì¼ HTML (Keyboard: Arrow Keys ì „ìš©)
   ---------------------------------------------------------
   - ê²©ì ê¸°ë°˜ ì´ë™(20x20)
   - í™”ì‚´í‘œí‚¤ ì…ë ¥ ë²„í¼(ì—­ì£¼í–‰ ë°©ì§€)
   - ë¨¹ì´ ì„­ì·¨ ì‹œ ì„±ì¥/ì ìˆ˜ ì¦ê°€
   - ë²½ ë˜ëŠ” ìê¸°ì¶©ëŒ ì‹œ ê²Œì„ì˜¤ë²„
   - ìµœê³ ì ìˆ˜(localStorage) ì €ì¥
   - setInterval ê¸°ë°˜ í‹± + ìº”ë²„ìŠ¤ ë Œë”ë§
   ========================================================= */
(() => {
  // ----- ì„¤ì •ê°’ -----
  const GRID = { cols: 20, rows: 20 };
  const CELL = 22;                   // ë‚´ë¶€ ìº”ë²„ìŠ¤ ì…€ í¬ê¸°(px)
  const SPEEDS = [170, 140, 115, 95, 80]; // ë‚œì´ë„ ë‹¨ê³„ë³„ í‹±(ms)
  const SCORE_TO_LEVEL = 5;          // ì ìˆ˜ në§ˆë‹¤ ì†ë„ ìƒìŠ¹
  const LABELS = ['ëŠë¦¼', 'ë³´í†µ', 'ë¹ ë¦„', 'ë§¤ìš° ë¹ ë¦„', 'ê·¹í•œ'];

  // ----- ìº”ë²„ìŠ¤/DOM -----
  const canvas = document.getElementById('board');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const speedLabelEl = document.getElementById('speedLabel');
  const liveEl = document.getElementById('live');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');

  // ë‚´ë¶€ í•´ìƒë„(í”½ì…€) â†’ ê²©ìÃ—ì…€í¬ê¸°
  canvas.width = GRID.cols * CELL;
  canvas.height = GRID.rows * CELL;

  // ----- ê²Œì„ ìƒíƒœ -----
  let snake;              // [{x,y}, ...] head â†’ tail
  let dir;                // {x,y} ì§„í–‰ë°©í–¥
  let queue;              // ì…ë ¥ ë²„í¼(ê¸‰ì„ íšŒ ì§€ì›, ì—­ì£¼í–‰ ë°©ì§€)
  let food;               // {x,y}
  let score, high, level; // ì ìˆ˜/ìµœê³ /ì†ë„ë ˆë²¨
  let state = 'idle';     // 'idle'|'running'|'paused'|'over'
  let timer = null;       // setInterval í•¸ë“¤
  let tickMs = SPEEDS[1]; // ì´ˆê¸° 'ë³´í†µ'

  // ----- ìœ í‹¸ -----
  const same = (a,b) => a.x===b.x && a.y===b.y;
  const inBounds = (p) => p.x>=0 && p.x<GRID.cols && p.y>=0 && p.y<GRID.rows;
  const opposite = (a,b) => (a.x === -b.x && a.y === -b.y);

  function setScore(v) {
    score = v;
    scoreEl.textContent = String(score);
    liveEl.textContent = `ì ìˆ˜ ${score}`;
    // ìµœê³  ì ìˆ˜ ê°±ì‹ 
    if (score > high) {
      high = score;
      highEl.textContent = String(high);
      localStorage.setItem('snake_high', String(high));
    }
    updateSpeed();
  }

  function updateSpeed() {
    // ì ìˆ˜ì— ë”°ë¼ ë ˆë²¨ ê³„ì‚°
    level = Math.min(SPEEDS.length - 1, Math.floor(score / SCORE_TO_LEVEL) + 1);
    tickMs = SPEEDS[level];
    speedLabelEl.textContent = LABELS[level];
    // ì‹¤í–‰ ì¤‘ì´ë©´ ì¸í„°ë²Œ ê°±ì‹ 
    if (state === 'running') {
      clearInterval(timer);
      timer = setInterval(step, tickMs);
    }
  }

  function randomFood() {
    // í˜„ì¬ ë±€ ëª¸í†µì„ ì œì™¸í•œ ë¹ˆ ì¹¸ ì¤‘ ëœë¤
    const occ = new Set(snake.map(c => `${c.x},${c.y}`));
    const empty = [];
    for (let y=0; y<GRID.rows; y++) {
      for (let x=0; x<GRID.cols; x++) {
        const key = `${x},${y}`;
        if (!occ.has(key)) empty.push({x,y});
      }
    }
    if (!empty.length) return null; // ê½‰ ì°¼ìœ¼ë©´(ì‚¬ì‹¤ìƒ ìŠ¹ë¦¬)
    return empty[(Math.random()*empty.length)|0];
  }

  function initGame() {
    snake = [{x:10, y:10}, {x:9, y:10}, {x:8, y:10}];
    dir = {x:1, y:0};     // ì²˜ìŒì—” ì˜¤ë¥¸ìª½
    queue = [];
    food = randomFood();
    score = 0;
    level = 1;
    tickMs = SPEEDS[level];
    speedLabelEl.textContent = LABELS[level];

    scoreEl.textContent = '0';
    high = Number(localStorage.getItem('snake_high') || 0);
    highEl.textContent = String(high);

    state = 'idle';
    clearInterval(timer); timer = null;
    draw();
  }

  // ----- ì…ë ¥ ì²˜ë¦¬(í™”ì‚´í‘œ ì „ìš©) -----
  window.addEventListener('keydown', (e) => {
    const key = e.key;
    let nd = null;
    if (key === 'ArrowUp') nd = {x:0, y:-1};
    else if (key === 'ArrowRight') nd = {x:1, y:0};
    else if (key === 'ArrowDown') nd = {x:0, y:1};
    else if (key === 'ArrowLeft') nd = {x:-1, y:0};
    else return;

    e.preventDefault();

    // ì—­ì£¼í–‰ ë°©ì§€: í˜„ì¬ ì§„í–‰ ë˜ëŠ” íì˜ ë§ˆì§€ë§‰ê³¼ ë°˜ëŒ€ë©´ ë¬´ì‹œ
    const lastDir = queue.length ? queue[queue.length-1] : dir;
    if (opposite(lastDir, nd)) return;
    // ê°™ì€ ë°©í–¥ ì¤‘ë³µ ë°©ì§€
    if (lastDir.x === nd.x && lastDir.y === nd.y) return;

    queue.push(nd);

    if (state === 'idle') start(); // ë°©í–¥ ì…ë ¥ìœ¼ë¡œë„ ì‹œì‘
  });

  // ----- ë²„íŠ¼ ì´ë²¤íŠ¸ -----
  startBtn.addEventListener('click', () => {
    if (state === 'running') { // ì¬ì‹œì‘
      initGame(); start();
    } else if (state === 'over') {
      initGame(); start();
    } else {
      start();
    }
  });
  pauseBtn.addEventListener('click', () => {
    if (state === 'running') pause();
    else if (state === 'paused') resume();
  });
  resetBtn.addEventListener('click', () => {
    initGame(); draw();
  });

  // ----- ê²Œì„ ì œì–´ -----
  function start() {
    if (state === 'over') initGame();
    state = 'running';
    startBtn.textContent = 'â–¶ï¸ ì¬ì‹œì‘';
    pauseBtn.disabled = false;
    pauseBtn.textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
    setScore(0);
    clearInterval(timer);
    timer = setInterval(step, tickMs);
  }
  function pause() {
    if (state !== 'running') return;
    state = 'paused';
    clearInterval(timer);
    pauseBtn.textContent = 'â–¶ï¸ ì¬ê°œ';
  }
  function resume() {
    if (state !== 'paused') return;
    state = 'running';
    pauseBtn.textContent = 'â¸ï¸ ì¼ì‹œì •ì§€';
    clearInterval(timer);
    timer = setInterval(step, tickMs);
  }
  function gameOver() {
    state = 'over';
    clearInterval(timer); timer = null;
    pauseBtn.disabled = true;
    liveEl.textContent = 'ê²Œì„ ì˜¤ë²„';
    draw(true);
  }

  // ----- í‹±(í•œ ì¹¸ ì´ë™) -----
  function step() {
    // ì…ë ¥ í ì†Œì§„(í•œ í‹±ì— í•œ ë²ˆë§Œ ì ìš©)
    if (queue.length) {
      const nd = queue.shift();
      if (!opposite(dir, nd)) dir = nd;
    }

    const head = snake[0];
    const next = { x: head.x + dir.x, y: head.y + dir.y };

    // ì¶©ëŒ ê²€ì‚¬(ë²½/ìê¸°)
    if (!inBounds(next) || snake.some((c, i) => i>0 && same(c, next))) {
      gameOver();
      return;
    }

    // ì´ë™
    snake.unshift(next); // ë¨¸ë¦¬ ì „ì§„

    // ë¨¹ì´?
    if (food && same(next, food)) {
      setScore(score + 1);
      food = randomFood();
    } else {
      snake.pop(); // ê¸¸ì´ ìœ ì§€(ê¼¬ë¦¬ ì œê±°)
    }

    draw();
  }

  // ----- ë Œë”ë§ -----
  function drawGrid() {
    // ë°°ê²½
    ctx.fillStyle = '#0a0c18';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ê·¸ë¦¬ë“œ ë¼ì¸
    ctx.strokeStyle = '#1b1f3a';
    ctx.lineWidth = 1;
    for (let x=1; x<GRID.cols; x++) {
      ctx.beginPath();
      ctx.moveTo(x*CELL + 0.5, 0);
      ctx.lineTo(x*CELL + 0.5, canvas.height);
      ctx.stroke();
    }
    for (let y=1; y<GRID.rows; y++) {
      ctx.beginPath();
      ctx.moveTo(0, y*CELL + 0.5);
      ctx.lineTo(canvas.width, y*CELL + 0.5);
      ctx.stroke();
    }
  }

  function rectCell(p, color) {
    const pad = 2; // ê°€ì¥ìë¦¬ ì—¬ë°±ìœ¼ë¡œ ë‘¥ê·¼ ëŠë‚Œ
    const x = p.x * CELL, y = p.y * CELL;
    ctx.fillStyle = color;
    ctx.fillRect(x + pad, y + pad, CELL - pad*2, CELL - pad*2);
  }

  function draw(gameOverOverlay=false) {
    drawGrid();

    // ìŒì‹
    if (food) rectCell(food, getComputedStyle(document.documentElement).getPropertyValue('--food') || '#ff6b6b');

    // ë±€
    snake.forEach((c, i) => {
      rectCell(c, i === 0 ? getCss('--head', '#41d1ff') : getCss('--body', '#59f28a'));
    });

    if (state === 'idle') overlay('â–¶ï¸ ì‹œì‘ ë˜ëŠ” í™”ì‚´í‘œí‚¤ë¡œ ì‹œì‘', '#ffffffcc');
    if (state === 'paused') overlay('ì¼ì‹œì •ì§€', '#ffffffcc');
    if (gameOverOverlay) overlay('ê²Œì„ ì˜¤ë²„ â€“ â–¶ï¸ë¡œ ì¬ì‹œì‘', '#ff6b6b');
  }

  function overlay(text, color) {
    ctx.save();
    ctx.fillStyle = '#00000080';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = color;
    ctx.font = 'bold 22px system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(text, canvas.width/2, canvas.height/2);
    ctx.restore();
  }

  function getCss(varName, fallback) {
    const v = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    return v || fallback;
  }

  // ----- ì´ˆê¸°í™” ë° ì²« ê·¸ë¦¬ê¸° -----
  initGame();
})();
</script>
</body>
</html>
